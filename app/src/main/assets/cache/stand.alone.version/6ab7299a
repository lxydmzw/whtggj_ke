!function(){"use strict";class e{constructor(){}static init(){Laya.ClassUtils.regClass}}e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e.init();class a{static init(e=null){a.setCallFun(e),null!=window.PlatformClass&&(this.bridge=window.PlatformClass.createClass("cn.popapps.ws.JWebSocketBridge"))}static setCallFun(e){window.natvieCallJs=e}static connect(e){this.bridge&&this.bridge.call("connect",e)}static send(e){this.bridge&&this.bridge.call("send",e)}static close(){this.bridge&&this.bridge.call("close")}static getBase(e,a){let t=new Laya.HttpRequest;t.http.timeout=1e4,t.once(Laya.Event.COMPLETE,this,function(e){a(e)}),t.once(Laya.Event.ERROR,this,function(e){a("")}),t.send(e,"","get","text")}static getQrCode(e,a,t,s="http://81.68.175.16:15006/qr/general"){let n=s+"?msg="+encodeURIComponent(e)+"&size="+a,o=new Laya.HttpRequest;o.http.timeout=1e4,o.once(Laya.Event.COMPLETE,this,function(e){t(e)}),o.once(Laya.Event.ERROR,this,function(e){t("")}),o.send(n,"","get","text")}}a.cdn="http://gserver.popapps.cn:15006",a.wsServer="wss://gserver.popapps.cn:15008",a.contrller_url="",a.room="",a.bridge=null,a.isConnect=!1;new class{constructor(){window.Laya3D?Laya3D.init(e.width,e.height):Laya.init(e.width,e.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=e.scaleMode,Laya.stage.screenMode=e.screenMode,Laya.stage.alignV=e.alignV,Laya.stage.alignH=e.alignH,Laya.URL.exportSceneToJson=e.exportSceneToJson,(e.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),e.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),e.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){let e=this,t=a.cdn+"/base/wq";a.getBase(t,function(t){let s=JSON.parse(t);a.contrller_url=s.data.url,a.wsServer=s.data.ws,e.initSoket()})}initSoket(){let e=this;a.init(function(a){switch(console.log("WebSocketBridge"),console.log(a),console.log(JSON.stringify(a)),a.tag){case"onOpen":break;case"onMessage":e.onServerMessage(a.data)}}.bind(this)),a.connect(a.wsServer+"/ws?type=0")}onServerMessage(t){let s=JSON.parse(t);if(console.log("obj.room的值为"+s.room),a.room=s.room,s.room==s.user&&1==s.code){let t=200;a.getQrCode(a.contrller_url+"?type=1&room="+a.room,t,function(a){e.startScene&&Laya.Scene.open(e.startScene);let t=JSON.parse(a),s=new Laya.Sprite;Laya.stage.addChild(s),s.loadImage(t.data),s.x=10,s.y=10},a.cdn+"/qr/general")}}}}();